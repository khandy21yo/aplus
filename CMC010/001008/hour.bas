10	  ! &
	  ! HOURJOB - MAINTAINS HOUR.DAT FILE WHERE COMPLETION %'S ARE STORED &
	  ! &
	  ! BY KEN TAYLOR AND WENDELL RICHARDSON   MAY 1978 &
	  ! 06/14/79 - BILL LOVEGROVE FOR GENERAL SYSTEM &
	  ! &
	  ! PRINT OPTION NOW PAGES CORRECTLY AND IS MILDLY READABLE &
	  ! BY BRIAN HANDY DEC-84 &
	  ! &

15	  ! &
	  ! PROGRAM INITIALIZATION &
	  ! &

20	  DIM S$(8%),P1$(9%),T(6%),T1(6%) &

25	  OPEN "NL:" AS FILE #1%,RECORD SIZE 64%:FIELD #1%,6% AS P1$(1%), &
	  8% AS P1$(2%),8% AS P1$(3%),8% AS P1$(4%),8% AS P1$(5%),8% AS P1$(6%), &
	  8% AS P1$(7%),8% AS P1$(8%):FIELD #1,64% AS T$ &

30	  V%=FNO%(2%,"HOUR.DAT","U","R") &
	\ IF V%=5% THEN GOTO 2500 ELSE IF V%<>0% THEN PRINT & 
	  "ERROR";V%;"IN OPENING HOUR.DAT." \ GOTO 10000 &

40	  ! RETURN FROM CREATING FILE. THIS LINE IS TO INSURE THAT WE &
	  ! RETURN TO THE CORRECT POINT IF THE PROGRAM GETS CHANGES SOMEHOW. &

50	  U1$=" ###,###.# ###,###.# ###,###.# ###,###.#" &

60	  S$(1%)="JOB NUMBER            " &
	\ S$(2%)="ACCOUNT NUMBER        " &
	\ S$(3%)="ESTIMATED HOURS       " &
	\ S$(4%)="EST. ADJUSTMENT       " &

70	  S$(5%)="REG. HOURS TO MONTH   " &
	\ S$(6%)="REG. HOURS CURRENT    " &
	\ S$(7%)="OVT. HOURS TO MONTH   " &
	\ S$(8%)="OVT. HOURS CURRENT    " &

1000	  ! &
	  ! PROGRAM CONTROL SECTION &
	  ! &

1005	  GOTO 1020 &

1010	  PRINT:PRINT "OPTIONS:  'ENTER' NEW JOB ITEMS" &
	\ PRINT "          'DELETE' EXISTING JOB ITEMS" &
	\ PRINT "          'REMOVE' ENTIRE JOB" &
	\ PRINT "          'CHANGE' JOB ITEM INFORMATION" &
	\ PRINT "          'EXAMINE' JOBS" &
	\ PRINT "          'FIND' A SINGLE ITEM" &
	\ PRINT "          'PRINT' ALL JOBS" &
	\ PRINT "          'UPDATE' PREVIOUS AMT & % WITH CURRENT AMT & %" &
	\ PRINT "          'END' PROGRAM AND UPDATE FILE" &

1020	  PRINT:INPUT "OPTION ";K$:K$=LEFT(K$,3%) &
	: GOTO 2000 IF K$="ENT" &
	: GOTO 3000 IF K$="DEL" &
	: GOTO 3200 IF K$="REM" &
	: GOTO 4000 IF K$="CHA" &
	: GOTO 5000 IF K$="EXA" &
	: GOTO 6000 IF K$="FIN" &
	: GOTO 7000 IF K$="PRI" &
	: GOTO 7100 IF K$="JOB" &
	: GOTO 7200 IF K$="UPD" &
	: GOTO 10000 IF K$="END" &

1040	  GOTO 1010 &

2000	  ! &
 	  ! ENTER JOBS &
	  ! &

2010	PRINT \ PRINT S$(1%); \ GOSUB 2200 \ GOTO 1020 IF K$="" &
	\ H$(1%)=K$ \ PRINT S$(2%); \ GOSUB 2200 \ H$(2%)=K$ &

2020	FOR I%=1% TO 6% \ PRINT S$(I%+2%); \ GOSUB 2200 &
	\  H(I%)=VAL(K$) \ NEXT I% &

2040	GOSUB 2100 \ STOP IF FNA%(2%,T$) \ GOTO 2010 &

2100	! &
	! ROUTINE TO PREPARE HOUR.DAT STRING &
	! &

2110	LSET P1$(I%)=H$(I%) FOR I%=1% TO 2% &
	\ LSET P1$(I%+2%)=CVTF$(H(I%)) FOR I%=1% TO 6% &
	\ RETURN &

2200	! &
	! INPUT LINE STRING &
	! &

2210	INPUT LINE K$:K$=CVT$$(K$,132%) &

2220	RETURN &

2300	! &
	! ROUTINE TO SEPARATE HOUR.DAT STRING &
 	! &

2310	LSET T$=FNL$ &
	\ H$(I%)=P1$(I%)+"" FOR I%=1% TO 2% &
	\ H(I%)=CVT$F(P1$(I%+2%)) FOR I%=1% TO 6% &
	\ RETURN &

2400	! &
	! PRINT ONE ITEM &
	! &

2410	PRINT H$(1%);" ";H$(2%);" "; &
	\ PRINT USING "###,###.##",H(I%); FOR I%=1% TO 6% &
	\ PRINT &

2430	T(I%)=T(I%)+H(I%) FOR I%=1% TO 6% \ RETURN &

2500	! &
	! CREATE HOUR.DAT FILE IF NON-EXISTANT &
	! &

2510	PRINT"AN HOUR FILE DOES NOT EXIST. SHOULD I CREATE ONE "; &
	\ INPUT C$ \ GOTO 10000 IF LEFT(C$,1%)<>"Y" &

2520	OPEN "HOUR.DAT" FOR OUTPUT AS FILE 2% &
	\ PRINT #2%,CVT%$(0%)+CVT%$(16%)+"S"+CHR$(128%); \ CLOSE 2% &
	\ OPEN "HOUR.DA1" FOR OUTPUT AS FILE 2% &
	\ PRINT #2%,CVT%$(0%)+CVT%$(64%)+"S"+CHR$(128%); \ CLOSE 2% &

2530	IF FNO%(2%,"HOUR.DAT","","") THEN PRINT &
	"ERROR";FNS%;"IN OPENING HOUR.DAT." \ GOTO 10000 &

2540	PRINT"FILE CREATED." \ GOTO 40 &

3000	! &
	! DELETE A FILE RECORD &
	! &

3010	PRINT \ PRINT "DELETE : " \ PRINT S$(1%); \ GOSUB 2200 &
	\ GOTO 1020 IF K$="" \  PRINT S$(2%); \ INPUT H$(2%) &

3020	GOTO 3030 IF FNG%(2%,(K$+SPACE$(6%-LEN(K$))+H$(2%))): &
	GOSUB 2300:GOSUB 2400:INPUT "CONFIRM (Y/N) ";K$: &
	STOP IF FND%(2%,"") IF LEFT (K$,1%)="Y":GOTO 3010 &

3030	PRINT "JOB NOT FOUND ":GOTO 3010 &

3200	! &
	! REMOVE ENTIRE JOB &
 	! &

3210	PRINT: PRINT "REMOVE ";S$(1%);: GOSUB 2200: GOTO 1020 IF K$="" &
	: K$=K$+SPACE$(6%-LEN(K$)) &

3220	IF FNG%(2%,K$) THEN PRINT "JOB NOT FOUND": GOTO 3200 &

3230	GOSUB 2300: PRINT "CONFIRM REMOVING JOB # ";H$(1%);" "; &
	: INPUT K$: GOTO 3200 UNLESS LEFT(K$,1%)="Y" &

3240	STOP IF FND%(2%,""): GOTO 3240 UNLESS FNG%(2%,H$(1%)) &
	: GOTO 3200 &

4000	! &
	! CHANGE ITEM RECORDS &
	! &

4010	PRINT:PRINT "CHANGE :":PRINT S$(1%);:GOSUB 2200:GOTO 1020 IF K$="" &

4015	PRINT S$(2%);:INPUT H$(2%) &

4020	V%=FNG%(2%,(K$+SPACE$(6%-LEN(K$))+H$(2%))) \ GOTO 4040 IF V% &
	\ GOSUB 2300 \ PRINT S$(1%);H$(1%);"   ";H$(2%) &
	\ FOR I%=1% TO 6% \ PRINT S$(I%+2%); &
	\ PRINT USING"#,###,###.##",H(I%); \ GOSUB 2200 &
	\ H(I%)=VAL(K$) IF K$<>"" \ NEXT I% &
	\ GOSUB 2100 \ STOP IF FNU%(2%,T$) \ GOTO 4010 &

4040	PRINT "JOB NOT FOUND ":GOTO 4010 &

5000	! &
	! EXAMINE A JOB &
	! &

5010	PRINT:PRINT "EXAMINE JOB # ";:GOSUB 2200:IF K$="" GOTO 1020 &

5015	L%=1000% : GOSUB 8000 &

5020	N9$=K$+"": &
	V%=FNG%(2%,"") IF FNG%(2%,N9$):GOSUB 2300 &

5025	IF P1$(1%)<N9$ THEN V%=FNN%(2%):GOTO 5010 IF V%:GOSUB 2300:GOTO 5025 &

5030	IF P1$(1%)>K$ THEN 5010 ELSE GOSUB 2400:IF FNN%(2%) THEN 5010 &

5040	GOSUB 2300:GOTO 5030 &

6000	! &
	! FIND A SINGLE RECORD &
	! &

6010	PRINT:PRINT S$(1%);:GOSUB 2200:GOTO 1020 IF K$="": &
	PRINT S$(2%);:INPUT H$(2%): &
	GOTO 6020 IF FNG%(2%,(K$+SPACE$(6%-LEN(K$))+H$(2%))): &
	GOSUB 2300:L%=1000%:GOSUB 8000:GOSUB 2400:GOTO 6010 &


6020	PRINT "JOB NOT FOUND ":GOTO 6010 &

7000	  ! &
	  ! PRINT COMPLETE JOB FILE &
	  ! &

7010	  IF FNO%(4%,"JOB.DAT","","")<>0% THEN PRINT &
		"YOU MUST CREATE JOB FILE BEFORE THIS CAN BE RUN." &
	\ GOTO 10000 &

7011	  INPUT "SET PAGE ";I% &
	: L%=62%:T3,T4,T5,T6,T7,T8=0. &
	: GOSUB 8000 &
	: X1%=99% &

7015	  GOTO 1020 IF FNG%(2%,"") &

7020	  GOSUB 2300 &
	: GOSUB 7060 IF H$(1%)<>J1$ &
	: GOSUB 8000 IF L%>57% &
	: GOSUB 2400 &
	: L%=L%+1% &
	: IF FNN%(2%) THEN 7090 ELSE 7020 &

7060	  GOSUB 7080 IF J1$<>"" &
	: J1$=H$(1%) &
	: IF FNG%(4%,J1$) THEN D$="UNKNOWN" ELSE D$=MID(FNL$,7%,60%) &

7070	  GOSUB 8000 IF L%>57% &
	: PRINT D$ &
	: L%=L%+1% &
	: RETURN &

7080	  PRINT "TOTAL";TAB(16%); &
	\ PRINT USING "###,###.##",T(I%); FOR I%=1% TO 6% &
	\ PRINT &
	\ PRINT &
	\ L%=L%+2% &
	\ T1(I%)=T1(I%)+T(I%) FOR I%=1% TO 6% &
	\ T(I%)=0. FOR I%=1% TO 6% &
	\ RETURN &

7090	GOSUB 7080 &
	\ T(I%)=T1(I%) FOR I%=1% TO 6% &
	\ PRINT &
	\ PRINT "GRAND "; &
	\ GOSUB 7080 &
	\ STOP IF FNC%(4%) &
	\ GOTO 1020 &

7100	! &
	!PRINT LIST OF JOB NUMBERS &
	! &

7110	STOP IF FNG%(2%,"") &

7120	LSET P1$(1%)=FNL$:GOTO 7140 IF P1$(1%)=J$ &
	:PRINT P1$(1%);" ";:PRINT IF POS(0%)>60% &
	:J$=P1$(1%)+"" &

7140	IF FNN%(2%) THEN 7150 ELSE 7120 &

7150	PRINT:GOTO 1020 &

7200	! &
	!UPDATE PREVIOUS AMOUNT AND % WITH CURRENT &
	! &

7210	INPUT "PLEASE VERIFY THAT YOU WANT TO UPDATE. (YES OR NO)",J$ &
	:GOTO 1010 IF J$<>"YES" &
	:STOP IF FNG%(2%,""):N%=0% &

7220	GOSUB 2300 &

7222	H(3%)=H(3%)+H(4%) \ H(5%)=H(5%)+H(6%) \ H(4%),H(6%)=0. &

7225	GOSUB 2100:STOP IF FNU%(2%,T$) &

7230	IF FNN%(2%) THEN 7240 ELSE 7220 &

7240	PRINT "DONE":GOTO 1020 &

8000	! &
	! SUB TO PRINT HEADING &
	! &

8010	PRINT STRING$(66%-L%,10%):PRINT DATE$(0%),TIME$(0%) &
	:PRINT TAB(28%);"ESTIMATE  TO MONTH   CURRENT  TO MONTH   CURRENT" &
	:PRINT "JOB    ACCT #     ESTIMATE    ADJUST   REGULAR   REGULAR "+ &
		"   O.TIME    O.TIME" &

8020	L%=4%:RETURN &

10000	! &
	! TERMINATE PROGRAM &
	! &

10010	STOP IF FNC%(2%) &
	:Q3$=CVT%$(8100%)+"!MENU.BAC"+SYS(CHR$(7%)) &
		IF ASCII(SYS(CHR$(7%)))=255% &
	:STOP IF FNC%(0%) &

10020	IF ASCII(SYS(CHR$(7%)))=255% THEN CHAIN "!MENU" 8100 ELSE GOTO 32767 &

32767	END &

